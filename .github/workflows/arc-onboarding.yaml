name: Azure Arc Onboard (Windows Self-hosted)
on:
  workflow_dispatch:
    inputs:
      clusterName:
        description: 'Name of the Kubernetes cluster'
        required: true
        default: 'AzureArcVClusterTestPOC'
      resourceGroup:
        description: 'Azure Resource Group name'
        required: true
        default: 'AzureArcVClusterTest'
      location:
        description: 'Azure region (e.g. WestUS3)'
        required: true
        default: 'WestUS3'
jobs:
  onboard-cluster:
    runs-on: self-hosted
    defaults:
      run:
        shell: pwsh  # Use PowerShell for Windows runners
    steps:
    - name: Checkout repo
      uses: actions/checkout@v3
    - name: Create Resource Group
      run: |
        az group create `
          --name "${{ github.event.inputs.resourceGroup }}" `
          --location "${{ github.event.inputs.location }}" `
          --output table
    - name: Connect Kubernetes Cluster to Azure Arc
      run: |
        az connectedk8s connect `
          --name "${{ github.event.inputs.clusterName }}" `
          --resource-group "${{ github.event.inputs.resourceGroup }}"
 